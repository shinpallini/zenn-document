---
title: "GolangでシンプルなIOモナドを実装してみよう"
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Haskell", "Monad", "モナド", "Golang", "Go"]
published: false
---

# はじめに

Haskellなどの純粋関数型言語を勉強している中で出てくる「モナド」があります。
この概念は最初よくわからず、色々調べる中で色々な表現で説明されていました。
例えば

- プログラムを構造化するための汎用的な抽象概念 [\[1\]](#参考)
- 自己関手の圏におけるモノイド対象 [\[2\]](#参考)
- `bind`関数と`toMonad`関数を持つ型 [\[3\]](#参考)

のようにいくつかの表現がありました。
調べている中で一番しっくり来たのが以下の記事(参考3)だったので、これをベースにシンプルなIOモナドを実装していきます。

https://www.infoq.com/jp/articles/Understanding-Monads-guide-for-perplexed/

この記事では基本的な標準入力を取得する関数`nextInput()`から始まり、これがシステムの状態に依存する変数であること、そして最終的にはモナドを活用してコード内にシステムの状態を明示的に表す部分を取り除くことに成功しています。
この流れに沿って実際に必要な関数をGolangで実装していきましょう。

なぜGolangか、というのは単純に自分が書きやすいという理由です。

# 実装

今回実装する必要がある関数は以下になります。

- `doInput`
    - 標準入力から1行読み取って文字列として取得する関数で、アクションを返す
- `doPrint`
    - 文字列を引数にとって標準出力に出す関数で、アクションを返す
- `bind`
    - 2つのアクションを1つにつなげる関数で、アクションを返す

これらの関数はすべてアクションを返す関数であり、つまりすべて同じコンテキストであると言えます。
また、`doInput()`が返すのは文字列の値ではなくアクションであり、この返り値自体を文字列操作するような方法はできません。

```go
func main() {
    input := doInput()
    fmt.Println("input: " + input)
}
```

あくまでこの関数が返すのは「標準入力から1行取得するというアクション」なので、文字列操作はできません。
そして文字列として変数に代入してしまうと、状態を持った変数がプログラム上に現れてしまいます。

今回の例ではtoMonad関数はdoPrintに当たりそう

# 参考
\[1\]:

https://ja.wikipedia.org/wiki/%E3%83%A2%E3%83%8A%E3%83%89_(%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0)

\[2\]:

https://techblog.ap-com.co.jp/entry/2022/12/28/175316

\[3\]:

https://www.infoq.com/jp/articles/Understanding-Monads-guide-for-perplexed/
